---
title : "Computer Vision - Ch.1~2"
categories :
    - ComputerVision
tag :
    - [ComputerVision]
toc : true
toc_sticky: true 
comments: true
sidebar_main: true
use_math: true
---

# 컴퓨터비전 공부 1일차
ComputerVision-오일석

## Ch.1_2 컴퓨터 비전 문제는 어떻게 해결하나?

### 과학적인 접근과 공학적 접근
<br>

컴퓨터비전의 목표는 2가지입니다.
<br>

1. 사람의 시각에 맞먹는 인공 시각을 만든다.
2. 한정된 범위에서 특정한 임무를 달성하는 인공 시각을 만든다.
<br>

하지만 여기서 목표1은 현재 많은 어려움이 있는데,<br>
예를들면 사람은 자연스럽게 자신이 보는 시야에서 어떠한 물체까지의 거리를 자연스럽게 파악하고, 그 과정에서 **기하학적 변환**(크기, 회전, 투영) 또는 **광도 변환**(조명, 그림자 등)이 있어도 자연스럽게 해석하는 반면 컴퓨터는 아직 그러한 알고리즘도 없고 쉽지가 않습니다.
(이러한 1번 목표에 관한 관점이 과학적 접근입니다.)
<br>

1번 목표로 하기가 어렵다면 우회해서 부분적인 기능을 잘 해내는 방식으로 우회할 수 밖에 없습니다. 이러한 2번 목표에 해당하는 관점을 공학적인 접근이라고 합니다.
<br>

### 계층적 처리

컴퓨터 비전의 처리과정은 다음과 같습니다.

$$
영상 - 전처리 - 특징추출 - 해석 - 고급묘사
$$

특징추출까지를 저급비전이라하고 해석부분을 고급비전이라합니다.
<br>

**특징추출(Feature Extraction)** 은 영상에서 에지, 선분, 원, 코너, 텍스쳐 등의 특징을 추출하는 단계입니다.
<br>

컴퓨터비전에서 분석하고자하는 영상에 따라 어떤 특징을 사용할지 정하는 일이 매우중요합니다.

* 얼굴인식 : Harr-like(유사 하르)
* 사람탐지 : HOG(Histogram Of Gradient)
* 물체인식, 물체추적 : 예전에는 에지나 영역특징을 사용 요즘에는 SIFT, SURF 같은 지역 특징을 사용.
<br>

### 문제 해결 도구

컴퓨터비전의 문제들을 해결하기 위해 여러가지 해결 도구들이 있습니다.
* 자료구조와 알고리즘
* 수학
* 기계학습

등을 사용합니다.
<br>

## 시스템 설계

시스템 설계 과정은 다음과 같습니다.<br>
**문제 이해 - 데이터베이스 수집 - 알고리즘 설계와 구현 - 성능평가**

챕터1은 개괄적인 요소들이 많으므로 간단히 훓고 넘어갔습니다.
<br>

## Ch.2 영상 처리

### 디지털 영상이란?
#### 획득과 표현

영상을 획득하는 장비인 카메라는 사람의 눈과 비슷한 구조를 가집니다.
수정체는 카메라의 렌즈역학을 하며, 망막은 CCD센서(필름)에 해당합니다.

<p align="center"><img src="/MYPICS/ComputerVision/01/1.png" width = "500" ></p>

위 그림은 **Pinhole(핀홀)** 카메라 모델로, 복잡한 카메라의 작동원리를 단순하게 표현한 모델입니다. 빛이 상자에 있는 작은 구멍으로 들어가서 상이 뒤집힌채로 CCD센서에 맺힙니다.

CCD센서는 세로방향 M, 가로방향 N 개의 점으로 샘플링하고, 화소(Pixel)라고 부르는 각 점의 밝기를 L단계로 양자화(quantization) 합니다.

<p align="center"><img src="/MYPICS/ComputerVision/01/1-1.jpeg" width = "500" ></p>

또한 영상처리에서 이제 우리는 기존에 알던 것과 조금은 어색하지만 익숙해져야할 부분이 있습니다. 
<br>

**2차원 영상 좌표계** 에서 원점은 좌측상단에 위치해 있고, 행렬연산을 많이 사용할 것이기 때문에 우리가 익숙한 가로, 세로 순서가 아닌 세로, 가로 순서가 됩니다.

또한 0부터 카운트하기 때문에, 
* 최대 화소는 M-1, N-1 까지가 됩니다.
* 해상도는 $M \times N $
* 명암의 범위는 [0~L-1], 보통 L=256
* L=2이면, 이진영상
* 컬러영상은 $f_{r}(x), f_{g}(x), f_{b}(x)$ 로 3가지를 가집니다.
    r(Red), g(Green), b(Blue)
<br>

### 히스토그램
#### 히스토그램 계산과 용도

히스토그램은 어떤 명암의 픽셀이 얼마나 분포해있는지 보기에 편안한 그래프입니다.

가로축은(0~256) 명암도를 나타내고, 세로축은 그 명암도를 가진 픽셀의 개수를 나타냅니다. 즉 히스토그램의 왼쪽부분의 그래프가 높으면 어두운 사진을 오른쪽편에 그래프가 높으면 밝은 사진을 나타내는 것입니다.

또한, 모든 히스토그램의 칸을 더하면 1이 되는 **정규 히스토그램** 은 다음과 같습니다.

$$
\hat{h}(l) = \frac{h(l)}{M \times N}
$$

<p align="center"><img src="/MYPICS/ComputerVision/01/2.png" width = "500" ></p>

뒤에서 더 다루겠지만 (C) 그림과 같이 한 눈에 보아도 두 픽셀의 분포가 높은 사진은 이진화하기 쉬운 사진이라고 할 수 있습니다.

히스토그램의 또 다른 역할은 조작을 통한 영상 품질의 개선입니다.
가장 대표적인 연산은 **히스토그램 평활화** 입니다.
<br>

히스토그램 평활화를 하게 되면 비교적 모여있는 명암의 화소들을 넓게 펴주어 명암의 범위를 넓혀줍니다. 즉, 동적 범위가 늘어나 영상이 이전보다 선명해집니다.
<br>

+ c() : 누적 히스토그램
+ round() : 반올림 연산
+ T() : 입력 영상 f의 명암값 $l_{in}$ 을 출력영상 g의 명암값 $l_{out}$ 으로 변환하는 매핑 함수.
<br>

$$
l_{out} = T(l_{in}) = round(c(l_{in})\times(L-1))
$$

$$
여기서 c(l_{in}) = \sum^{l_{in}}_{l=0} \hat{h}(l)
$$

<p align="center"><img src="/MYPICS/ComputerVision/01/3.png" width = "500" ></p>

히스토그램 평활화덕분에 얼룩말이 선명하게 보이는 것을 볼 수 있습니다.

<p align="center"><img src="/MYPICS/ComputerVision/01/4.png" width = "500" ></p>

반면에 이번에는 히스토그램 평활화를 했더니 오히려 품질이 떨어진 예입니다.
새의 깃털의 텍스쳐도 훼손되었으나, 새에게 먹히는 곤충을 확인하는 목적이라면 평활화한 영상이 더 적합하다 할 수 있습니다.
<br>

#### 히스토그램 역투영과 얼굴 검출

일반적인 사진의 경우, 명암이라는 한가지 요소로만 이용하면 얼굴과 같은 사진에서 비슷한 명암을 갖는 다른 영역이 여러군데 존재할 가능성이 높아서 얼굴을 구별하기 어렵게 됩니다.

그러므로 RGB 색상 공간을 HSI 공간으로 변환한 다음, I채널(명암)은 무시하고 H채널(색상)과 S채널(채도)를 사용합니다

간단히하면, H와 S채널의 값이 높을 수록 얼굴일 확률이 높아진다라는 의미입니다. 대신 이 방법은 얼굴색과 유사한 배경이 없다는 가정하에 효율적인 방법입니다. 
<br>

## 이진 영상

우리는 때때로 영상을 흑과 백으로 이루어진 이진 영상으로 바꿀 필요가 있습니다.

### 이진화와 오츄 알고리즘

앞에서 이진 영상을 살짝 소개하면서 뒤쪽에서 더 자세히 다룬다고 한 내용 기억나시나요?

딱 눈에 보이게 두개의 명암으로 분리되는 사진이나 영상이 아니라면 어떻게 이진 영상으로 변환할 수 있을까요?

정답은 어떠한 임계값을 기준으로 그 기준보다 낮으면 흑으로 높으면 백색으로 바꾸는 것입니다. 수식은 다음과 같습니다.

$$
b(j,i) = \begin{cases} 1, & f(j,i) \geq T \\ 0, & f(j,i) < T \end{cases}
$$

엇! 그렇다면 결국 두 구간을 나누는 **임계값 T(threshold)** 가 필요한데, 한눈에 나눠야하는 곳이 보이지 않는다면 어떻게 해야할까요?

이 질문의 해답이 바로 **오츄 알고리즘** 입니다.

임계값 t를 기준으로 나누었을 때, 각 집합의 명암 분포가 균일할수록, 즉 분산이 낮을수록 높은 점수를 주어서, 가능한 모든 t에 대해서 점수를 계산한 후 가장 좋은 t를 최종 임계값으로 정하는 것이 바로 오츄 알고리즘입니다. 일종의 최적화 알고리즘입니다.(optimizaion algorithm)

최적화 알고리즘을 계산하는데 사용하는 함수를 목적함수(objective function) or 비용함수(cost function)이라 부릅니다. 딥러닝의 손실함수와 비슷한 개념이네요!

위의 예시에서 분산이 작을수록 균일성이 크므로, 목적함수값이 작을수록 점수가 높다고 셍각하여야합니다. 딥러닝처럼 손실이 최소화되는 그 지점을 찾아야하는 것처럼 말이죠.

아래식은 오츄알고리즘의 핵심입니다.
$$
T = argmin \ v_{within}(t)
\\ t \in \{0,1, \cdots , L-1\}
$$

교재에는 분산과 평균 그리고 상수처리할 수 있는 점들을 이용하여 간단히하는 부분이 나와있는데, 수식의 압박이 상당하기 때문에 궁금하신 분들은 따로 찾아보시길 추천드립니다.

공부를 더 해보면서 중요한 수식이라 생각이들면 추후 추가수정하겠습니다.

<p align="center"><img src="/MYPICS/ComputerVision/01/5.png" width = "500" ></p>

위 사진은 오츄알고리즘에 의해 컴퓨터가 찾아준 임계값으로 이진 영상처리한 사진입니다. (b) 사진은 가격표가 제대로 보이지 않고, (c) 사진은 달이 보이지 않는 문제점이 발생하였습니다.

이를 해결하려면 임계값을 k개 사용하여 k+1개의 구간으로 구분하는 다중 임계값 방법을 사용해야 합니다. 이는 5장에서 다시 다루겠습니다.
<br>

### 연결요소

화소는 어떤 모양을 사용할까요? 만일 원모양을 사용한다면 원과 원사이의 빈공간을 해결할 수 없고, 6각형을 사용한다면 좌표계로 딱 정의하기 어렵다는 단점이 있어서 사각형을 사용합니다.

사각형끼리 맞닿아 있을 때, 동서남북 4개의 화소를 이웃으로 간주하는 4-연결성과 주위를 둘러싼 여덟 개 화소를 모두 이웃으로 삼는 8-연결성 두가지가 있습니다.
<br>

## 영상 처리의 세 가지 기본 연산

영상 처리란, 기존의 화소에 새로운 값을 대입해준다 라고 생각할 수 있습니다.
소개되는 방법들 이외에 다른 여러가지들도 모두 이 3가지에 해당됩니다.

먼저 **점 연산** 은 자신의 값만 보고 새로운 값을 결정한다 라고 보시면 되겠습니다.

**영역 연산** 은 이웃에 있는 몇 개의 화소들을 보고 새로운 값을 결정하는 방식입니다.

마지막으로 **기하 연산** 은 일정학 기하학적 규칙에 따라 다른 곳에 있는 값을 취하는 방법입니다.
<br>

### 점 연산

점 연산의 기본적인 식은 다음과 같습니다.

$$
f_{out}(j,i) = t(f_{1}(j,i), f_{2}(j,i), \cdots , f_{k}(j,i))
$$

위의 식은 대부분 한 장의 영상을 입력값으로 줍니다.

이제, 영상을 밝거나 어둡게 그리고 반전을 줄 수 있는 **선형 연산(linear operation** 은

$$
f_{out}(j,i) = t(f(j,i)) = \begin{cases} min(f(j,i)+a,L-1), & (밝게) \\ max(f(j,i)-a,0), & (어둡게) \\ (L-1)-f(j,i), & (반전) \end{cases}
$$

내일 이어서...