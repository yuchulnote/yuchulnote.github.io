---
title : "Lec 10-1: CNN - Convolution 연산"
categories :
    - Deep_Learning_Study
tag :
    - [Deep_Learning_Study, Convolution Neural Network]
toc : true
toc_sticky: true 
comments: true
sidebar_main: true
use_math: true
published: true
---

# 딥러닝 공부 17일차
<br>
<br>

>합성곱 신경망(CNN, Convolution Neural Network)는 이미지 처리에 탁월한 성능을 보입니다.<br>
합성곱 신경망은 크게 Convolution Layer(합성곱층) 과 Pooling Layer(풀링층)으로 구성되어있습니다.

## 합성곱연산이 필요한 이유

앞서 우리가 예제 코드로 해보았던 MNIST 처럼 글자를 분류하고 싶다고 가정해보겠습니다.

아래의 그림은 알파벳 Y를 정자로 쓴 글씨와 휘갈겨 쓴 글씨 두개를 2차원 행렬로 표현한 것입니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/1.png" width = "300" ></p>

사람이 보기에는 둘다 y로 보이지만 기계의 입장에서는 각 픽셀마다 가진 값이 거의 상이하므로 완전히 다른값을 가진 입력으로 인식합니다.

이를 다층 퍼셉트론으로 분류한다면 이미지를 1차원 백터로 변환하고 입력층으로 사용해야합니다.

이미지를 1차원 벡터로 변환하면 아래와 같습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/2.png" width = "400" ></p>

1차원으로 변환된 모습은 사람이 보기에도 도대체 이게 무엇인가... 싶습니다 이는 기계한테도 마찬가지입니다.

이러한 이미지 처리에서는 공간적인 구조정보가 중요한 이유입니다.

그래서 이미지의 공간적인 구조 정보를 보존하면서 학습할 수 있는 방법이 필요해졌고, 이를 사용한것이 CNN 이 되는 것입니다.
<br>

## Channel(채널)

이미지 처리의 기본적인 용어인 채널에 대해서 간단히 정리하면

기계는 글자나, 이미지보다 텐서를 더 잘 처리할 수 있습니다.
이미지는 **(높이, 너비, 채널)** 이라는 3차원 텐서입니다.

여기서 높이는 이미지의 세로방향 픽셀수, 너비는 이미지의 가로방향 픽셀수 그리고 채널은 이미지의 색깔 성분을 의미합니다.

흑백이미지는 채널 수가 1이고, 각 픽셀은 0부터 255 사이의 값을 가집니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/3.png" width = "300" ></p>

위 손글씨 데이터는 (28, 28, 1)의 크기를 가지는 3차원 텐서입니다. 그렇다면 흑백이 아니라 컬러 이미지는 어떨까요?

우리가 흔히 들어본 RGB로 색을 분류할 수 있기 때문에 채널 수가 3개가 됩니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/4.png" width = "300" ></p>

하나의 픽셀은 3원색의 조합으로 이루어집니다. 만약 높이가 28, 너비가 28인 컬러 이미지였다면 위 사진은 (28, 28, 3)인 3차원 텐서로 표현된다고 할 수 있습니다.
<br>

## Convolution operation(합성곱 연산)

>Convolution이란 이미지 위에서 stride 값 만큼 filter(kernel)을 이동시키면서 겹쳐지는 부분의 각 원소의 값을 곱해서 모두 더한 값을 출력으로 하는 연산을 말합니다.

stride는 커널이 이동하는 스텝의 크기라고 생각하면 되겠습니다.
커널은 보통 3 x 3 또는 5 x 5를 사용합니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/5.png" width = "600" ></p>

연산과정을 조금 더 자세히 살펴보겠습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/6.png" width = "600" ></p>

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/7.png" width = "600" ></p>

이렇게 전체 사진을 한바퀴 돌고난 결과는 아래와 같습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/8.png" width = "200" ></p>

위와 같이 입력으로부터 커널을 사용하여 합성곱 연상르 통해 나온 결과를 **특성 뱁(feature map)** 이라고 합니다.
<br>

## Padding(패딩)

앞의 예제에서 5x5 입력 이미지에서 3x3 커널로 연산을 마치고 나온 결과가 3x3 특성 맵을 얻었습니다.
이와같이 합성곱연산을 통해 나온결과는 입력값의 크기보다 작아진다는 특징이 있습니다.

>이럴 때, 합성곱 연산 이후에도 특성 맵의 크기가 입력의 크기와 동일하게 유지되도록 하고 싶다면 패딩을 사용하면 됩니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/9.png" width = "450" ></p>

패딩은 **합성곱연산을 하기 전에** 입력의 가장자리에 지전된 개수의 폭만큼 행과 열을 추가해주는 것을 말합니다.

주로 제로 패딩(zero padding)을 사용합니다. 즉 위 그림처럼 테두리에 0으로 이루어진 액자가 생긴다고 생각하시면 되겠습니다.
<br>

## 가중치와 편향

다층 퍼셉트론으로 3x3 이미지를 처리한다고 가정해보겠습니다. 우선 이미지를 1차원인 텐서로 만들면, 3x3=9 가 되므로 입력층은 9개의 뉴런을 가집니다. 그리고 예시로 4개의 은닉층을 추가한다고 해보겠습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/10.png" width = "300" ></p>

위에서 각 연결선은 가중치를 의미한다고 이전에 배워서 알고있습니다. 그러므로 위에서 가중치는 9x4=36 개의 가중치를 가집니다.

더 쉬운 예제로 3x3 이미지를 2x2 커널(필터)를 사용하여, 1 스트라이드로 연산을 해보겠습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/11.png" width = "350" ></p>

사실 합성곱 연산에서 가중치는 커널(필터) 행렬의 원소들입니다. 이를 인공 신경망의 형태로 표현한다면 다음과 같습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/12.png" width = "500" ></p>

특성 맵을 얻기 위해서는 동일한 커널로 이미지 전체를 훓으며 합성곱 연산을 진행합니다. 결국 이미지 전체를 훓으면서 사용되는 가중치는 $w_{0},w_{1},w_{2},w_{3}$ 4개 뿐입니다.

그러므로 합성곱 신경망은 다층 퍼셉트론을 사용할 때보다 훨씬 적은 수의 가중치를 사용하며 공간적 구조 정보를 보존한다는 특징이 있습니다.

아래 그림은 위 예제를 모두 연결시켜본 그림입니다. Fully Connected Layer와 비교하면 확실히 적은 것을 보실 수 있습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec10-1/13.jpeg" width = "500" ></p>
