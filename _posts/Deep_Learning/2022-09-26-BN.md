---
title : "BatchNormalization 구현하기(with Python Numpy)"
categories :
    - Deep_Learning_Study
tag :
    - [Deep_Learning, Numpy, Python, BatchNormalization]
toc : true
toc_sticky: true
comments: true
sidebar_main: true
use_math: true
published: true
---

>오늘은 BatchNormalization을 파이썬 넘파이로 구현하고 하나씩 뜯어서 공부해보려합니다.

[Batch Normalization 복습하기] 👈  클릭!

[Batch Normalization 복습하기]:https://yuchulnote.github.io/deep_learning_study/Lab09-3,4/#batch-normalization

```py
class BatchNormalization:

    def __init__(self, gamma, beta, momentum=0.9, running_mean=None, running_var=None):
        self.gamma = gamma
        self.beta = beta
        self.momentum = momentum
        self.input_shape = None # 합성곱계층은 4차원, 완전연결 계층은 2차원

        # 시험할 때 사용할 평균과 분산
        self.running_mean = running_mean
        self.running_var = running_var

        # backward시 사용할 중간 데이터
        self.batch_size = None
        self.xc = None # 평균을 0으로 만들기 위한...
        self.std = None #표준편차
        self.dgamma = None #감마미분값
        self.dbeta = None #베타미분값

    def forward(self, x, train_flg=True): #순전파, 학습데이터 학습시
        self.input_shape = x.shape #입력 데이터 모양
        if x.ndim != 2: #입력 차원값이 2가 아니라면, 합성곱계층
            N, C, H, W = x.shape # 순서대로 BatchSize, Channel수, 높이, 너비
            x = x.reshape(N, -1) # Batchsize크기만큼을 행으로 가지는 행렬로 resize
        
        out = self.__forward(x, trainflg) #out값에 BN 순전파 값을 저장

        return out.reshape(*self.input_shape) # *(asterisk), 입력모양을 정확히 알 수 없으므로 사용! 어떤 입력모양이 들어와도 동작하게끔

    def __forward(self, x, train_flg):
        if self.running_mean is None:
            N, D = x.shape # N: batch_size, D: Features
            # 각 feature 별로 정규화를 진행하기 때문에 평균과 분산을 feature 개수만큼 0으로 초기화
            self.running_mean = np.zeros(D)
            self.running_var = np.zeros(D)
        
        if train_flg:
            mu = x.mean(axis=0) #mu : 평균
            xc = x - mu # 평균이 0이 되도록 x에서 평균만큼 빼기
            var = np.mean(xc**2, axis=0)
            std = np.sqrt(var + 10e-7)
            xn = xc/std

            self.batch_size = x.shape[0]

```

내일 이어서 공부...