---
title : "Lec 11-3 : RNN Timeseries"
categories :
    - Deep_Learning_Study
tag :
    - [Deep_Learning_Study, RNN, Timeseries]
toc : true
toc_sticky: true 
comments: true
sidebar_main: true
use_math: true
published: true
---

# 딥러닝 공부 28일차
<br>

## Time Series Data

<p align="center"><img src="/MYPICS/Deep_Learning/lec11-4/1.png" width = "700" ></p>

주식하는 사람들은 어디서 많이 본 그래프일 것 같은데요, 제가 봤을 때는 작년 미국시장 S&P500 지수 그래프와 많이 유사한 것처럼 보입니다.

각설하고, 이러한 주가는 여러가지 변수에 의한 요인이 있겠지만 어찌되었던 시간과 관련이 있는 데이터라고 할 수 있습니다.

<p align="center"><img src="/MYPICS/Deep_Learning/lec11-4/2.png" width = "700" ></p>

**data-02-stock_daily.csv**

이러한 주가에서 5가지 항목들을 예측해보는 모델을 만들어 보겠습니다.
5가지 항목은 시작가, 최고가, 최저가, 거래량, 종가 입니다.
<br>

### Many-to-One

<p align="center"><img src="/MYPICS/Deep_Learning/lec11-4/3.png" width = "700" ></p>

위 그림과 같은 구조를 여러개의 Input으로 한개의 결과값을 유추한다는 느낌으로 Many-to-One 이라고 표현합니다.

만약에 우리가 저 주가예측 RNN을 통해 종가를 알고 싶다고 가정해보겠습니다.

이 때, 마지막 8번으로 출력되는 값을 종가 한가지만 출력한다고하면 hidden_state = 1이 될 것입니다. 이렇게 되면 문제가 발생하는게 모델의 입장에서는 부담감이 확 커질 것 입니다.

왜냐하면 hidden_state 값이 한개가 되어버린다면 이전 셀들에서 나오는 모든 값들의 hidden_state 값이 1이 되어야 할 것입니다.

왜냐하면 output_size 와 hidden_size는 동일하기 때문입니다.
[복습하고오기]

[복습하고오기]:https://yuchulnote.github.io/deep_learning_study/Lab11-1/#output-shape

그렇기 때문에 머신입장에서는 5가지의 성질로 학습한 것을 한가지의 결과물로 압축해서 표현해야하는데 이는 쉽지 않기 때문입니다.

그래서 보통적으로 한가지의 성질이 궁금하다면 hidden_size는 5라고 가정해보겠습니다. (5가지 성질을 보장할 만한 사이즈이기만 하면 됨)

그 hidden_size를 유지한채로 학습을 끝마친 뒤, FC layer를 통해 원하는 성질 값으로 뽑아내는 것이 일반적인 모델의 구성입니다.
<br>

### Data Reading

```py
# 기초 import setting
import torch
import torch.optim as optim
import numpy as np
import matplotlib.pyplot as plt

# 랜덤 시드
torch.manual_seed(0)

seq_length = 7 # 7일 간의 데이터로 학습한다고 했으므로
data_dim = 5 # 시가, 종가, 최고가, 최저가, 거래량 -> 5개
hidden_dim = 10 # 5개 이상의 널널한 값으로 그냥 10개라고 하겠습니다.
output_dim = 1 # FC layer를 거치고 뽑아낼 '종가' -> 1개
learning_rate = 0.01 # 학습률 = 0.01
iterations = 500 # Batch_size x iteration = 총 데이터 개수

xy = np.loadtxt("data-02-stock_daily.csv", delimiter=",") # 데이터 불러오기
xy = xy[::-1] # 0부터10까지 배열이라하면 default 값은 [0:10:1]인데 마지막 1은 생략해서 썼던 것이고 여기서는 [::-1] 이라하면 처음부터 끝까지 다 세는데 -1 이므로 마지막에서 한개씩 세준다 -> 거꾸로 뒤집는다.

# 역순으로 뒤집어주는 이유는 1일차부터 학습시키기 위한 것 같습니다.

train_size = int(len(xy) * 0.7) # 학습 사이즈로 데이터의 70%만 사용하겠다는 의미
train_set = xy[0:train_size]
test_set = xy[train_size - seq_length:] 
```

>+) csv 객체<br>
text 파일 형태로 데이터 처리시 문장 내에 들어가 있는 콤마(,)에 대해 전처리 과정이 필요합니다.
따라서 CSV 객체를 사용하는 것이 한층 편리합니다. 파이썬에 내장되어 있습니다. (위 코드에서는 객체를 사용하지 않았습니다)<br>
delimiter는 CSV 파일이 뭘로 나누어져 있는지(\t, ' ', '+' 등)를 나타낸다.

```py
train_set = minmax_scaler(train_set) # 스케일을 해주는 이유는 ~
test_set = minmax_scaler(test_set)

trainX, trainY = build_dataset(train_set, seq_length)
```

>+) Minmax_scaler 함수<br>
Minmax_scaler 함수는 스케일을 조정해주는 함수로, 모든 데이터가 0~1 사이의 값을 갖도록 해주는 함수입니다. (최대값은 1, 최소값은 0)<br>
쉽게 말해서 정규화 함수라고 보시면 되겠습니다.